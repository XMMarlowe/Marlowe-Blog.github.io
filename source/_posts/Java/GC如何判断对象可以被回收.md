---
title: GC如何判断对象可以被回收
author: Marlowe
tags:
  - Java
  - JVM
  - GC
categories: Java
abbrlink: 5955
date: 2021-03-09 16:26:44
---

<!--more-->

### 引用计数法
方式：每个对象有一个引用计数属性，新增一个引用时计数加1，引用释放时计数减1，计数为0时可以回收。
优点：实现简单，效率高。
缺点：无法解决循环引用。

### 可达性分析法
方式：从一系列被称为GC ROOT的对象开始，向下搜索，搜索走过的路径称为引用链，当一个对象到GC ROOT之间没有引用链，说明这个对象不可用。

#### GC ROOT对象：
* 虚拟机栈中引用的对象
* 方法区内类的静态属性引用的对象
* 方法区常量引用的对象
* 本地方法栈中引用的对象

#### finalize()
当一个对象被判定为不可达对象后，也并不是非死不可。
在通过可达性分析算法判断没有引用链使之与GC ROOT相连，会判断该对象是否有必要执行finalize方法:
假如重写了finalize，并且未调用过，则说明有必要执行。

判断有必要执行finalize的对象，会被放入一个队列，有jvm建立的低优先级的Finalizer线程去执行。

当在finalize中自救成功的对象，就会在第二次标记时移除即将回收的集合。
自救失败的就会被回收，不会再执行finalize。

所谓自救就是把自己与引用链上的一个对象关联起来。




