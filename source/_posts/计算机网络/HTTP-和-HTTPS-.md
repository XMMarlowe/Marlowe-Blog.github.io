---
title: HTTP 和 HTTPS
author: Marlowe
tags:
  - HTTP
  - HTTPS
categories: 计算机网络
abbrlink: 49970
date: 2021-03-22 22:11:06
---
<!--more-->

### HTTP

### HTTPS

### 区别
1. 端口 ：HTTP的URL由“http://”起始且默认使用端口80，而HTTPS的URL由“https://”起始且默认使用端口443。
2. 安全性和资源消耗： HTTP协议运行在TCP之上，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份。HTTPS是运行在SSL/TLS之上的HTTP协议，SSL/TLS 运行在TCP之上。所有传输的内容都经过加密，加密采用对称加密，但对称加密的密钥用服务器方的证书进行了非对称加密。所以说，HTTP 安全性没有 HTTPS高，但是 HTTPS 比HTTP耗费更多服务器资源。
  * 对称加密：密钥只有一个，加密解密为同一个密码，且加解密速度快，典型的对称加密算法有DES、AES等；
  * 非对称加密：密钥成对出现（且根据公钥无法推知私钥，根据私钥也无法推知公钥），加密解密使用不同密钥（公钥加密需要私钥解密，私钥加密需要公钥解密），相对对称加密速度较慢，典型的非对称加密算法有RSA、DSA等。

### HTTPS为什么安全？

因为HTTPS保证了传输安全，防止传输过程被监听、防止数据被窃取，可以确认网站的真实
性。

###  HTTPS的传输过程是怎样的?

客户端发起HTTPS请求，服务端返回证书，客户端对证书进行验证，验证通过后本地生成用于
改造对称加密算法的随机数，通过证书中的公钥对随机数进行加密传输到服务端，服务端接收后通过私钥解密得到随机数，之后的数据交互通过对称加密算法进行加解密。

1. 客户使用https的URL访问Web服务器，要求与Web服务器建立SSL连接。
2. Web服务器收到客户端请求后，会将网站的证书信息（证书中包含公钥）传送一份给客户端。
3. 客户端拿到证书，证书校验通过后，用系统内置的CA证书，进行对证书解密，拿到公钥。
4. 客户端的浏览器与Web服务器开始协商SSL/TLS连接的安全等级，也就是信息加密的等级。
5. 客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站。
6. Web服务器利用自己的私钥解密出会话密钥。
7. Web服务器利用会话密钥对数据进行对称加密，再与客户端进程通讯。


<center>

![HTTPS传输过程](https://gitee.com/unclezs/image-blog/raw/master/blog/20200917102430.png)
</center>

### CA证书的作用
CA证书就是服务端自己有一份公钥私钥，把公钥给CA证书，获得一份数字证书，当客户端来请求时，就拿这个数字证书给客户端，客户端再通过CA认证算法拿到公钥，再进行后续操作。



### 为什么需要证书?

防止”中间人“攻击，同时可以为网站提供身份证明。

### 使用Https会被抓包吗？
会被抓包，HTTPS只防止用户在不知情的情况下通信被监听，如果用户主动授信，是可以构建
“中间人”网络，代理软件可以对传输内容进行解密。


### SSL/TLS协议的基本过程

#### 客户端发出请求（ClientHello）
1. 支持的协议版本，比如TLS 1.0版。
2. 一个客户端生成的随机数，稍后用于生成”对话密钥”。
3. 支持的加密方法，比如RSA公钥加密。
4. 支持的压缩方法。
#### 服务器回应（SeverHello）
1. 确认使用的加密通信协议版本，比如TLS 1.0版本。如果浏览器与服务器支持的版本不一致，服务器关闭加密通信。
2. 一个服务器生成的随机数，稍后用于生成”对话密钥”。
3. 确认使用的加密方法，比如RSA公钥加密，此时带有公钥信息。
4. 服务器证书。
#### 客户端回应
1. 一个随机数pre-master key。该随机数用服务器公钥加密，防止被窃听。
2. 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。
3. 客户端握手结束通知，表示客户端的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供服务器校验。

上面客户端回应中第一项的随机数，是整个握手阶段出现的第三个随机数，又称”pre-master key”。有了它以后，客户端和服务器就同时有了三个随机数，接着双方就用事先商定的加密方法，各自生成本次会话所用的同一把”会话密钥”。

### 一些问题
#### 那么为什么一定要用三个随机数，来生成”会话密钥”呢？
为了保证绝对随机，不相信服务器或者客户端的随机数，而是才用三个随机数再进行一定算法计算出真正的 会话密钥(对称加密)。
#### 为什么不都使用对称加密而是才有非对称与对称加密组合？
因为非对称加密比较耗费性能，比对称加密慢了几倍甚至几百倍，所以才有了对称加密进行最终的数据加密。


### 参考
[HTTP与HTTPS详解](https://blog.unclezs.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/HTTP%E4%B8%8EHTTPS%E8%AF%A6%E8%A7%A3.html)