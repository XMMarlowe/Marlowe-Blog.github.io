---
title: 初识HTTP2.0
author: Marlowe
tags: HTTP
categories: 计算机网络
abbrlink: 3514
date: 2021-04-29 21:02:52
---

HTTP/2是HTTP协议自1999年HTTP 1.1发布后的首个更新，主要基于SPDY协议。由互联网
工程任务组(IETF) 的Hypertext Transfer Protocol Bis (httpbis) 工作小组进行开发。该组织于2014年12月将HTTP/2标准提议递交至IESG进行讨论，于2015年2月17日被批准。HTTP/2标准于2015年5月以RFC 7540正式发表。
<!--more-->

### 简介

HTTP/2（超文本传输协议第2版，最初命名为HTTP 2.0），是HTTP协议的的第二个主要版本，使用于万维网。HTTP/2是HTTP协议自1999年HTTP 1.1发布后的首个更新，主要基于SPDY协议（是Google开发的基于TCP的应用层协议，用以最小化网络延迟，提升网络速度，优化用户的网络使用体验）。

### 相对于HTTP/1.1的改进


#### 二进制分帧
HTTP/2（超文本传输协议第2版，最初命名为HTTP 2.0），是HTTP协议的的第二个主要版本，使用于万维网。HTTP/2是HTTP协议自1999年HTTP 1.1发布后的首个更新，主要基于SPDY协议（是Google开发的基于TCP的应用层协议，用以最小化网络延迟，提升网络速度，优化用户的网络使用体验）。

<center>

![20210429210655](http://marlowe.oss-cn-beijing.aliyuncs.com/img/20210429210655.png)
</center>

在二进制分帧层中，HTTP/2 会将所有传输的信息分割为更小的消息和帧(frame)，并对它们采用二进制格式的编码。
这种单连接多资源的方式，减少了服务端的压力，使得内存占用更少，连接吞吐量更大。而且,TCP连接数的减少使得网络拥塞状况得以改善，同时慢启动时间的减少，使拥塞和丢包恢复速度更快。


#### 多路复用

多路复用允许同时通过单一的HTTP/2.0连接发起多重 的请求-响应消息。在HTTP1.1协议中,浏览器客户端在同一时间，针对同一域名下的请求有一定数量的限制， 超过了这个限制的请求就会被阻塞。而多路复用允许同时通过单一的HTTP2.0连接发起多重的“请求-响应"消息。

HTTP2的请求的TCP的connection一旦建立，后续请求以stream的方式发送。每个stream的基本组成单位是frame (二进制帧)。客户端和服务器可以把HTTP消息分解为互不依赖的帧，然后乱序发送，最后再在另一端把它们重新组合起来。

![20210429211046](http://marlowe.oss-cn-beijing.aliyuncs.com/img/20210429211046.png)

也就是说，HTTP2.0 通信都在一个连接 上完成，这个连接可以承载任意数量的双向数据流。就好比，我请求一个页面baidu.com。页面上所有的资源请求都是客户端与服务器上的一条TCP上请求和响应的!

#### header压缩

HTTP/1.1的header带有大量信息，而且每次都要重复发送。HTTP/2 为了减少这部分开销，采用了HPACK头部压缩算法对Header进行压缩。

![20210429211202](http://marlowe.oss-cn-beijing.aliyuncs.com/img/20210429211202.png)


#### 服务端推送

简单来讲就是当用户的浏览器和服务器在建立连接后，服务器主动将一些资源推送给浏览器并缓存起来的机制。有了缓存，当浏览器想要访问已缓存的资源的时候就可以直接从缓存中读取了。

![20210429211313](http://marlowe.oss-cn-beijing.aliyuncs.com/img/20210429211313.png)


### 一些问题

#### HTTP/2为什么是二进制？

比起像HTTP/1.x这样的文本协议，**二进制协议解析起来更高效、“线上”更紧凑，更重要的是错误更少。**


#### 为什么 HTTP/2 需要多路传输?

HTTP/1.x 有个问题叫线端阻塞(head-of-line blocking), 它是指一个连接(connection)一次只提交一个请求的效率比较高, 多了就会变慢。 HTTP/1.1 试过用流水线(pipelining)来解决这个问题, 但是效果并不理想(数据量较大或者速度较慢的响应, 会阻碍排在他后面的请求). 此外, 由于网络媒介(intermediary )和服务器不能很好的支持流水线, 导致部署起来困难重重。而多路传输(Multiplexing)能很好的解决这些问题, 因为它能同时处理多个消息的请求和响应; 甚至可以在传输过程中将一个消息跟另外一个掺杂在一起。**所以客户端只需要一个连接就能加载一个页面。**

#### 消息头为什么需要压缩?

假定一个页面有80个资源需要加载（这个数量对于今天的Web而言还是挺保守的）, 而每一次请求都有1400字节的消息头（着同样也并不少见，因为Cookie和引用等东西的存在）, 至少要7到8个来回去“在线”获得这些消息头。这还不包括响应时间——那只是从客户端那里获取到它们所花的时间而已。这全都由于TCP的慢启动机制，它会基于对已知有多少个包，来确定还要来回去获取哪些包 – 这很明显的限制了最初的几个来回可以发送的数据包的数量。相比之下，即使是头部轻微的压缩也可以是让那些请求只需一个来回就能搞定——有时候甚至一个包就可以了。这种开销是可以被节省下来的，特别是当你考虑移动客户端应用的时候，即使是良好条件下，一般也会看到几百毫秒的来回延迟。

#### 服务器推送的好处是什么？
当浏览器请求一个网页时，服务器将会发回HTML，在服务器开始发送JavaScript、图片和CSS前，服务器需要等待浏览器解析HTML和发送所有内嵌资源的请求。**服务器推送服务通过“推送”那些它认为客户端将会需要的内容到客户端的缓存中，以此来避免往返的延迟。**

### 参考

[HTTP 2.0 和 HTTP 1.1 相比有哪些优势呢？](https://www.zhihu.com/question/306768582/answer/576026225)

[HTTP 2.0与HTTP 1.1区别](https://www.cnblogs.com/frankyou/p/6145485.html)

